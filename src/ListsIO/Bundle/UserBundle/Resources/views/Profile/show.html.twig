{# User profile page (Logged in & Logged Out Users) #}

{% extends "FOSUserBundle::layout.html.twig" %}

{% block title %}Lists.io |
	{{ user.username }}
{% endblock %}

{% spaceless %} 
{% set imgURL = [
 "assets/images/bg/bg-img-01.jpg"
,"assets/images/bg/bg-img-02.jpg"
,"assets/images/bg/bg-img-03.jpg"
,"assets/images/bg/bg-img-04.jpg"
,"assets/images/bg/bg-img-05.jpg"
,"assets/images/bg/bg-img-06.jpg"
,"assets/images/bg/bg-img-07.jpg"
,"assets/images/bg/bg-img-08.jpg"
,"assets/images/bg/bg-img-09.jpg"
,"assets/images/bg/bg-img-10.jpg"
,"assets/images/bg/bg-img-11.jpg"
,"assets/images/bg/bg-img-12.jpg"
,"assets/images/bg/bg-img-13.jpg"
,"assets/images/bg/bg-img-14.jpg"
,"assets/images/bg/bg-img-15.jpg"
,"assets/images/bg/bg-img-16.jpg"
,"assets/images/bg/bg-img-17.jpg"
,"assets/images/bg/bg-img-18.jpg"
,"assets/images/bg/bg-img-19.jpg"
,"assets/images/bg/bg-img-20.jpg"
,"assets/images/bg/bg-img-21.jpg"
,"assets/images/bg/bg-img-22.jpg"
,"assets/images/bg/bg-img-23.jpg"
,"assets/images/bg/bg-img-24.jpg"
,"assets/images/bg/bg-img-25.jpg"
,"assets/images/bg/bg-img-26.jpg"
,"assets/images/bg/bg-img-27.jpg"
,"assets/images/bg/bg-img-28.jpg"
,"assets/images/bg/bg-img-29.jpg"
,"assets/images/bg/bg-img-30.jpg"
,"assets/images/bg/bg-img-31.jpg"
,"assets/images/bg/bg-img-32.jpg"
,"assets/images/bg/bg-img-33.jpg"
,"assets/images/bg/bg-img-34.jpg"
,"assets/images/bg/bg-img-35.jpg"
,"assets/images/bg/bg-img-36.jpg"
,"assets/images/bg/bg-img-37.jpg"
,"assets/images/bg/bg-img-38.jpg"
,"assets/images/bg/bg-img-39.jpg"
,"assets/images/bg/bg-img-40.jpg"
,"assets/images/bg/bg-img-41.jpg"
,"assets/images/bg/bg-img-42.jpg"
,"assets/images/bg/bg-img-43.jpg"
,"assets/images/bg/bg-img-44.jpg"
,"assets/images/bg/bg-img-45.jpg"
,"assets/images/bg/bg-img-46.jpg"
,"assets/images/bg/bg-img-47.jpg"
,"assets/images/bg/bg-img-48.jpg"
,"assets/images/bg/bg-img-49.jpg"
] %}

{% set randomImgURL = asset(random(imgURL)) %}
{% endspaceless %}

{% if is_granted("IS_AUTHENTICATED_REMEMBERED") and user.id == app.user.id %}
    {% set userIsOwner = true %}
{% else %}
    {% set userIsOwner = false %}
{% endif %}

{% block fos_user_content %}
<div class="background background-mobile" style="min-height: 100%; min-width: 100%;">
    <div class="mobile-background" style="background-image: url(' {{randomImgURL}} ');">
        <div class="profile-wrapper" data-user_id="{{ user.Id }}">
            <!-- Error: Getting current user's info, not author info -->
            <div class="gravatar-image">
                <div class="gravatar-inner">
                    <img src="{{ user.profilePicURL }}">
                </div>
            </div>
            <h1 class="profile-name">
                {{ user.username }}
            </h1>
            {% set followed = user %}
            {% include 'ListsIOUserBundle:Follow:follow_btn.html.twig' %}
        </div>
        <div class="container toggle-wrapper">
            <div class="profile-toggle" id="master-profile-toggle">
                <ul>
                    <li class="active" data-toggle="lists">Lists
                    </li><li data-toggle="follows">Follows ({{ user.follows|length}}|{{ user.followedBy|length }})</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="container profile-lists-wrapper profile-lists-toggle active">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <div class="profile-toggle sub-profile-toggle sub-master-profile-toggle">
                <ul>
                    <li class="active sub-toggle" data-toggle="lists-lists">Lists
                    </li><li class="sub-toggle" data-toggle="lists-likes">Likes
                    </li><li class="nearby-lists-tab sub-toggle" data-toggle="lists-nearby">Nearby</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="container profile-lists-wrapper sub-toggle-wrapper profile-lists-lists-toggle">
            <div class="col-md-6 col-md-offset-3">
                {% if userIsOwner %}
                    <div class="list-button-wrapper create-button">
                        <a class="add-list-button" href="{{ path('lists_io_edit_new_list') }}">
                            <table>
                                <tr>
                                    <td class="add-img"><span class="icon-add-list"></span></td>
                                    <td class="add-txt">Create a List</td>
                                </tr>
                            </table>
                        </a>
                    </div>
                {% endif %}
                <ul>
                    {% if user.lists is empty%}
                        <h3 class='no-info-message'>Dang! {{user.username}} has no lists yet.</h3>
                    {% else %}
                        {% for list in user.lists %}
                            {% if (list.title) or (user.id == app.user.id) %}
                                {% set title = list.title ? list.title : "Untitled" %}
                                <li data-id="{{ list.id }}">
                                    {%  set listURL = userIsOwner ? path('lists_io_edit_list', {'id': list.id}) : path('lists_io_view_list', {'id': list.id}) %}
                                    <a href="{{ listURL }}">
                                        <h3 class="list-title">{{ title }}</h3>
                                        {%  if list.subtitle %}
                                            <span class="list-subtitle">{{ list.subtitle|converturls|nl2br }}</span>
                                        {% endif %}
                                        {% if list.locString %}
                                            <div class="list-location">{{ list.locString }}</div>
                                        {% endif %}
                                    </a>
                                    {% if userIsOwner %}
                                        <a class="delete-list delete-button" href="javascript:void(0)"><span class="icon-cancel"></span></a>
                                    {% endif %}
                                </li>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </ul>
            </div>
        </div>
        <div class="container profile-lists-wrapper sub-toggle-wrapper profile-lists-likes-toggle" style="display:none">
            <div class="col-md-8 col-md-offset-2">
                {% if user.listLikes is empty%}
                    <h3 class='no-info-message'>What?! {{user.username}} has no likes yet.</h3>
                {% else %}
                    <div class="lists-wrapper with-author">
                        <ul>
                            {% for likes in user.listLikes %}
                                <li data-id="{{ likes.list.id }}">
                                    <a href="{{ path('lists_io_view_list', {'id': likes.list.id}) }}">
                                        <h3 class="list-title">{{ likes.list.title }}</h3>
                                        <div class="list-subtitle">{{ likes.list.subtitle }}</div>
                                        <div class="author"><a href="{{ path('lists_io_user_view_by_username', {'username': likes.list.user.username}) }}"><img class="loggedin" src="{{ likes.list.user.profilePicURL }}"> by {{ likes.list.user.username }}</a></div>
                                        {% if list.locString %}
                                            <div class="list-location">{{ list.locString }}</div>
                                        {% endif %}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="container profile-lists-wrapper sub-toggle-wrapper profile-lists-nearby-toggle" style="display:none">
            <div class="col-md-6 col-md-offset-3">
            </div>
        </div>
    </div>
</div>
<div class="container profile-users-wrapper profile-follows-toggle" style="display:none">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="profile-toggle sub-profile-toggle sub-master-profile-toggle">
                <ul>
                    <li class="sub-toggle active" data-toggle="follows-follows">Following ({{ user.follows|length}})
                    </li><li class="sub-toggle" data-toggle="follows-followedby">Followers ({{ user.followedBy|length }})</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="container profile-users-wrapper default sub-toggle-wrapper profile-follows-follows-toggle">
            <div class="col-md-8 col-md-offset-2">
                {% set follows = user.follows() %}
                {% if follows is empty %}
                    {% if userIsOwner %}
                        <h3 class='no-info-message'>Seriously? You aren't following anyone yet!</h3>
                    {% else %}
                        <h3 class='no-info-message'>Really though?! {{user.username}} isn't following anyone yet.</h3>
                    {% endif %}
                {% else %}
                    <ul class="list-of-users">
                        {% for follow in follows %}
                            {% set followed = follow.followed %}
                            <li class="author col-md-4" data-id="{{ followed.id }}"><a href="{{ path('lists_io_user_view_by_username', {'username': followed.username}) }}"><img class="loggedin" src="{{ followed.profilePicURL }}"> {{ followed.username }}</a></li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
        <div class="container profile-users-wrapper sub-toggle-wrapper profile-follows-followedby-toggle" style="display:none">
            <div class="col-md-6 col-md-offset-2">
                {% set follows = user.followedBy %}
                {% if follows is empty %}
                    {% if userIsOwner %}
                        <h3 class='no-info-message'>The heck?! You aren't followed by anyone yet.</h3>
                    {% else %}
                        <h3 class='no-info-message'>Weird, {{user.username}} isn't followed by anyone yet.</h3>
                    {% endif %}
                {% else %}
                    <ul class="list-of-users">
                        {% for follow in follows %}
                            {% set follower = follow.follower %}
                            <li class="author col-md-4" data-id="{{ follower.id }}"><a href="{{ path('lists_io_user_view_by_username', {'username': follower.username}) }}"><img class="loggedin" src="{{ follower.profilePicURL }}"> {{ follower.username }}</a></li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </div>
</div>


					
{% include "FOSUserBundle:Profile:show_content.html.twig" %}
{% endblock fos_user_content %}
